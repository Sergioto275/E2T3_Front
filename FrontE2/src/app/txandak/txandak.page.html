<app-header></app-header>

<ion-content class="ion-page" id="main-content">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title size="large">Txandak</ion-title>
    <ion-select slot="end" [(ngModel)]="selectedLanguage" (ionChange)="changeLanguage()">
      <ion-select-option value="es">Español</ion-select-option>
      <ion-select-option value="eu">Euskera</ion-select-option>
    </ion-select>
  </ion-toolbar>

  <ion-content [fullscreen]="true">
    <!-- Botón para añadir nueva txanda -->
    <ion-button expand="full" color="success" id="txanda-sortu-modal">
      Añadir Txanda
    </ion-button>

    <!-- Lista de Txandas -->
    <ion-list>
      <ion-item *ngFor="let txanda of txandak">
        <ion-label>
          <h2>{{ txanda.mota === 'G' ? 'Garbiketa' : txanda.mota === 'M' ? 'Mahaia' : txanda.mota }}</h2>
          <p>{{ txanda.data }}</p>
          <p>{{ txanda.id }}</p>

          <!-- Mostrar alumno directamente -->
          <p><strong>Alumno:</strong> 
            <span *ngIf="txanda.alumno">
              {{ txanda.alumno.izena }} {{ txanda.alumno.abizenak }}
            </span>
            <span *ngIf="!txanda.alumno">
              Desconocido
            </span>
          </p>
        </ion-label>        
        <!-- Botón para eliminar -->
        <ion-button (click)="deleteTxanda(txanda.id!)" color="danger" slot="end">Eliminar</ion-button>
      </ion-item>
    </ion-list>

    <!-- Lista de Alumnos -->
    <ion-list>
      <ion-item *ngFor="let alumno of filteredAlumnos">
        <ion-label>
          <h2>{{ alumno.izena }} {{ alumno.abizenak }} {{ alumno.id }}</h2>
        </ion-label>
      </ion-item>
    </ion-list>
  </ion-content>

  <!-- Modal para añadir una nueva txanda -->
  <ion-modal trigger="txanda-sortu-modal">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Añadir Txanda</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <!-- Selección del tipo de txanda -->
      <ion-item>
        <ion-label position="stacked">Tipo de Txanda</ion-label>
        <ion-select
          [(ngModel)]="nuevaTxanda.mota"
          placeholder="Selecciona tipo de txanda"
        >
          <ion-select-option value="G">Garbiketa</ion-select-option>
          <ion-select-option value="M">Mahaia</ion-select-option>
        </ion-select>
      </ion-item>

      <!-- Fecha de la txanda -->
      <ion-item>
        <ion-label position="stacked">Fecha</ion-label>
        <ion-input
          type="date"
          [(ngModel)]="nuevaTxanda.data"
          placeholder="Selecciona la fecha"
        ></ion-input>
      </ion-item>

      <!-- Selección del alumno -->
      <ion-item>
        <ion-label position="stacked">Alumno</ion-label>
        <ion-select
          [(ngModel)]="nuevaTxanda.alumno"
          placeholder="Selecciona un alumno"
        >
          <ion-select-option
            *ngFor="let alumno of filteredAlumnos"
            [value]="alumno.id"
          >
            {{ alumno.izena }} {{ alumno.abizenak }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <!-- Botón para guardar, deshabilitado si no están completos los campos -->
      <ion-button
        expand="full"
        (click)="guardarTxanda()"
        [disabled]="!nuevaTxanda.mota || !nuevaTxanda.data || !nuevaTxanda.alumno"
      >
        Guardar Txanda
      </ion-button>
    </ion-content>
  </ng-template>
</ion-modal>

</ion-content>
