<ion-content [fullscreen]="true">
  <ion-header>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button></ion-menu-button>
      </ion-buttons>
      <ion-title>{{ "historial.titulo" | translate }}</ion-title>
      <ion-select slot="end" [(ngModel)]="selectedLanguage" (ionChange)="changeLanguage()">
        <ion-select-option value="es">Español</ion-select-option>
        <ion-select-option value="eu">Euskera</ion-select-option>
      </ion-select>
    </ion-toolbar>
    <ion-segment>
      <ion-segment-button value="prod" content-id="prod">
        <ion-label>{{ "historial.botones.productos" | translate }}</ion-label>
      </ion-segment-button>
      <ion-segment-button value="material" content-id="material">
        <ion-label>{{ "historial.botones.materiales" | translate }}</ion-label>
      </ion-segment-button>
      <ion-segment-button value="ticket" content-id="ticket">
        <ion-label>{{ "historial.botones.ticket" | translate }}</ion-label>
      </ion-segment-button>
      <ion-segment-button value="cliente" content-id="cliente">
        <ion-label>{{ "historial.botones.cliente" | translate }}</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-header>

  <ion-segment-view>
    <ion-segment-content id="prod">
      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="6" size-lg="4" *ngFor="let prod of produktuMugimendu">
            <ion-card>
              <ion-card-header>
                <ion-card-title>{{ prod.produktu.izena }}</ion-card-title>
                <ion-card-subtitle>{{ prod.data | date: 'short' }}</ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <ion-row>
                  <ion-col size="6">
                    <ion-label><strong>{{ prod.langile.izena }} {{ prod.langile.abizenak }} | {{ prod.langile.taldeaKodea }}</strong></ion-label>
                  </ion-col>
                  <ion-col size="6">
                    <ion-label><strong>{{ "historial.modal.cantidad" | translate }}:</strong> -{{ prod.kopurua }}</ion-label>
                  </ion-col>
                </ion-row>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-segment-content>

    <ion-segment-content id="material">
      <!-- Aquí puedes agregar contenido similar para el segmento de material -->
    </ion-segment-content>
    
    <ion-segment-content id="ticket">
      <ion-grid>
        <ion-row>
          <ion-col size="12" size-md="6" size-lg="4" *ngFor="let ticket of tickets">
            <ion-card>
              <ion-card-header>
                <ion-card-title>{{ ticket.izena }}</ion-card-title>
                <ion-card-subtitle>{{ ticket.id }}</ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <ion-row>
                  <ion-col>
                    <ion-label>
                      <strong>{{ "citas.modal.fecha" | translate }}:</strong> {{ ticket.data }}
                    </ion-label>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col size="6">
                    <ion-label>
                      <strong>{{ "citas.modal.horaInicio" | translate }}:</strong> {{ ticket.hasieraOrduaErreala }}
                    </ion-label>
                  </ion-col>
                  <ion-col size="6">
                    <ion-label>
                      <strong>{{ "citas.modal.horaFin" | translate }}:</strong> {{ ticket.amaieraOrduaErreala }}
                    </ion-label>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col size="12">
                    <ion-label>
                      <strong>{{ "citas.modal.descripcion" | translate }}:</strong> {{ ticket.deskribapena }}
                    </ion-label>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col size="12">
                    <ion-label>
                      <strong>{{ "citas.modal.casa" | translate }}:</strong> {{ ticket.etxekoa }}
                    </ion-label>
                  </ion-col>
                </ion-row>
                <ion-card-header>
                  <ion-card-title>{{ "historial.modal.servicios" | translate }}</ion-card-title>
                </ion-card-header>
                <ion-list>
                  <ion-item *ngFor="let linea of ticket.lerroak">
                    <ion-label>
                      <strong>{{ linea.zerbitzuak.izena }}</strong><br />
                      <ion-label>
                        {{ "historial.modal.precio" | translate }}: {{ linea.prezioa }} €
                      </ion-label>
                    </ion-label>
                  </ion-item>
                </ion-list>
                <ion-row>
                  <ion-col size="10">
                    <ion-label>
                      <strong>{{ "historial.modal.total" | translate }}:</strong> {{ ticket.prezioTotala }} €
                    </ion-label>
                  </ion-col>
                  <ion-col size="2">
                    <ion-button (click)="cargarCita(ticket.id)">
                      <ion-icon name="download"></ion-icon>
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-segment-content>
    
    <ion-segment-content id="cliente">
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ "historial.modal.ficha" | translate }}</ion-title>
          <ion-buttons slot="end">
            <ion-button id="add-bezero">{{ "historial.modal.añadir_cliente" | translate }}</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
    
      <ion-content>
        <!-- Lista de Bezero -->
        <ion-list id="bezero-list">
          <ion-item *ngFor="let bezero of bezeroak">
            <ion-label>
              <h2>{{ bezero.izena }} {{ bezero.abizena }}</h2>
              <p>{{ "historial.modal.telefono" | translate }}: {{ bezero.telefonoa }}</p>
            </ion-label>
            <ion-buttons slot="end">
              <ion-button color="primary" (click)="openBezero(bezero)">Editar</ion-button>
              <ion-button color="danger" (click)="deleteBezero(bezero.id)">Eliminar</ion-button>
            </ion-buttons>
          </ion-item>
        </ion-list>
      </ion-content>
    </ion-segment-content>    
  </ion-segment-view>

  <ion-modal trigger="add-bezero">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ 'historial.modal.añadir_cliente' | translate }}</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-item>
          <ion-label position="stacked">{{ 'historial.modal.nombre' | translate }}</ion-label>
          <ion-input [(ngModel)]="crearNombre" placeholder="Izena"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'historial.modal.apellido' | translate }}</ion-label>
          <ion-input [(ngModel)]="crearApellido" placeholder="Apellido"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'historial.modal.telefono' | translate }}</ion-label>
          <ion-input [(ngModel)]="crearTelefono" placeholder="123456789"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'historial.modal.piel' | translate }}</ion-label>
          <ion-checkbox [(ngModel)]="crearPiel"></ion-checkbox>
        </ion-item>
        <ion-button expand="full" (click)="crear_bezero()">{{ 'historial.botones.crear' | translate }}</ion-button>
      </ion-content>
    </ng-template> 
  </ion-modal>

  <ion-modal [isOpen]="isEditingBezero" class="custom-modal" backdropDismiss="false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ 'historial.modal.detalles_cliente' | translate }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarModal()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <!-- Datos del Cliente -->
        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ editingBezero.izena }} {{ editingBezero.abizena }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-item>
              <ion-label position="stacked">{{ 'historial.modal.nombre' | translate }}</ion-label>
              <ion-input [(ngModel)]="editingBezero.izena"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">{{ 'historial.modal.apellido' | translate }}</ion-label>
              <ion-input [(ngModel)]="editingBezero.abizena"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">{{ 'historial.modal.telefono' | translate }}</ion-label>
              <ion-input [(ngModel)]="editingBezero.telefonoa"></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">{{ 'historial.modal.piel' | translate }}</ion-label>
              <ion-checkbox [(ngModel)]="editingBezero.azalSentikorra"></ion-checkbox>
            </ion-item>
          </ion-card-content>
        </ion-card>
        
        <!-- Historial del Cliente -->
        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ 'historial.botones.cliente' | translate }}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ng-container *ngFor="let hist of editingBezero.historiala; let i = index">
                <ion-item *ngIf="hist.ezabatzeData == null">
                  <ion-item>
                    <ion-select [(ngModel)]="hist.id_produktua" placeholder="Seleccione un producto">
                      <ion-select-option *ngFor="let prod of produktuak" [value]="prod.id">
                        {{prod.izena}}
                      </ion-select-option>
                    </ion-select>
                  </ion-item>
                  <ion-item *ngIf="hist.ezabatzeData == null">
                    <ion-label position="stacked">{{ 'historial.modal.fecha' | translate }}</ion-label>
                    <ion-input [(ngModel)]="hist.data" type="date"></ion-input>
                  </ion-item>
                  <ion-item *ngIf="hist.ezabatzeData == null">
                    <ion-label position="stacked">{{ 'historial.modal.cantidad' | translate }}</ion-label>
                    <ion-input [(ngModel)]="hist.kantitatea" type="number"></ion-input>
                  </ion-item>
                  <ion-item *ngIf="hist.ezabatzeData == null">
                    <ion-label position="stacked">{{ 'historial.modal.volumen' | translate }}</ion-label>
                    <ion-input [(ngModel)]="hist.bolumena" type="text"></ion-input>
                  </ion-item>
                  <ion-item *ngIf="hist.ezabatzeData == null">
                    <ion-label position="stacked">{{ 'historial.modal.comentarios' | translate }}</ion-label>
                    <ion-input [(ngModel)]="hist.oharrak" type="text"></ion-input>
                  </ion-item>
                  <ion-button color="danger" (click)="remove_historial(i)"><ion-icon name="trash"></ion-icon></ion-button>
                </ion-item>
                
              </ng-container>
              
              
            </ion-list>
            <ion-button (click)="add_historial()" expand="full">{{ 'historial.botones.añadir' | translate }}</ion-button>
            <ion-button (click)="guardar_bezero()" expand="full">{{ 'historial.botones.guardar' | translate }}</ion-button>
          </ion-card-content>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- <ion-modal isOpen="{{ isViewingHistorial }}">
    <ion-header>
      <ion-toolbar>
        <ion-title>Historial de {{ viewingBezero?.izena }}</ion-title>
        <ion-buttons slot="end">
          <ion-button id="add-historial" (click)="addHistorial(viewingBezero.id)">Añadir</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content> -->
      <!-- Lista de Historial -->
      <!-- <ion-list id="historial-list">
        <ion-item *ngFor="let historial of viewingBezero.historiala" (click)="editHistorial(historial)">
          <ion-label>
            <h2>{{ historial.produktua.izena }}</h2>
            <p>Kantitatea: {{ historial.kantitatea }}</p>
            <p>Fecha: {{ historial.data | date }}</p>
          </ion-label>
          <ion-buttons slot="end">
            <ion-button color="primary" (click)="editHistorial(historial)">Editar</ion-button>
            <ion-button color="danger" (click)="deleteHistorial(historial.id)">Eliminar</ion-button>
          </ion-buttons>
        </ion-item>
      </ion-list>
    </ion-content>
  </ion-modal> -->
  
</ion-content>
