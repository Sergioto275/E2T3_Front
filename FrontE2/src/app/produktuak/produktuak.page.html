<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>{{ 'productos.title' | translate }}</ion-title>
    <ion-select slot="end" [(ngModel)]="selectedLanguage" (ionChange)="changeLanguage()">
      <ion-select-option value="es">Español</ion-select-option>
      <ion-select-option value="eu">Euskera</ion-select-option>
    </ion-select>
  </ion-toolbar>
</ion-header>
<ion-content [fullscreen]="true" id="main-content">
  <app-header></app-header>

  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button id="cat-sortu-modal">{{ 'productos.botones.crearCategoria' | translate }}</ion-button>
    </ion-buttons>
    <ion-buttons slot="start">
      <ion-button id="prod-sortu-modal">{{ 'productos.botones.agregarProducto' | translate }}</ion-button>
    </ion-buttons>
    <ion-buttons slot="start">
      <ion-button id="prod-editar-modal" [disabled]="productosSeleccionados.length > 1 || productosSeleccionados.length == 0" (click)="cargarEditarProducto()">{{ 'productos.botones.editarProductos' | translate }}</ion-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button id="atera-modal">{{ 'productos.botones.sacarProductos' | translate }}</ion-button>
    </ion-buttons>
  </ion-toolbar>  

  <ng-container *ngFor="let categoria of produktuak">
    <!-- Categoría -->
    <ion-item button (click)="toggleCategoria(categoria.izena)">
      <ion-label>{{ categoria.izena }}</ion-label>
      <ion-button slot="end">
        <ion-icon name="create"></ion-icon>
      </ion-button>
      <ion-button slot="end" (click)="eliminarKategoriaProducto(categoria.id)">
        <ion-icon name="trash"></ion-icon>
      </ion-button>
      <ion-icon [name]="isCategoriaAbierta(categoria.izena) ? 'chevron-up' : 'chevron-down'" slot="end"></ion-icon>
    </ion-item>
  
    <!-- Lista de productos dentro de la categoría -->
    <ion-list *ngIf="isCategoriaAbierta(categoria.izena)">
      <ion-item *ngFor="let producto of categoria.produktuak">
        <ion-label> {{ producto.izena }} - Stock: {{ producto.stock }} </ion-label>
        <ion-checkbox slot="start" [(ngModel)]="producto.selected" (ionChange)="actualizarProductosSeleccionados(producto, categoria.id)"></ion-checkbox>
        <ion-button slot="end" (click)="eliminarProducto(producto.id)">
          <ion-icon name="trash"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>
  </ng-container>
  
  <!-- Modal para sacar productos -->
  <ion-modal trigger="atera-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ 'productos.botones.sacarProductos' | translate }}</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-item>
          <ion-select [(ngModel)]="selecTaldea" label="Taldea" placeholder="Selecciona a un grupo" (ionChange)="onGrupoChange()">
            <ion-select-option *ngFor="let taldea of alumnos" [value]="taldea.kodea">
              {{ taldea.kodea }} : {{ taldea.izena }}
            </ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-select [(ngModel)]="selecAlumno" label="Alumno" placeholder="Selecciona a un alumno">
            <ion-select-option *ngFor="let alumno of filteredAlumnos" [value]="alumno.id">
              {{ alumno.id }} : {{ alumno.izena }}
            </ion-select-option>
          </ion-select>
        </ion-item>        
        <ion-button expand="full" (click)="confirmarSacarProductos()">{{ 'productos.botones.confirmar' | translate }}</ion-button>
        <ion-list>
          <ion-item *ngFor="let prod of productosSeleccionados">
            <ion-label> {{prod.izena}} </ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template> 
  </ion-modal>
  
  <ion-modal trigger="prod-sortu-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ 'productos.botones.crearProductos' | translate }}</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.nombre' | translate }}</ion-label>
          <ion-input [(ngModel)]="crearNombre" placeholder="Izena"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.descripcion' | translate }}</ion-label>
          <ion-input [(ngModel)]="crearDescripcion" placeholder="Deskribapena"></ion-input>
        </ion-item>
        <ion-item>
          <ion-select [(ngModel)]="crearCategoria" label="Kategoria" placeholder="Selecciona una kategoria">
            <ion-select-option *ngFor="let cat of produktuak" [value]="cat.id">{{cat.izena}}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.marca' | translate }}</ion-label>
          <ion-input [(ngModel)]="crearMarca" placeholder="Marka"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.stock' | translate }}</ion-label>
          <ion-input [(ngModel)]="crearStock" type="number" placeholder="Stock"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.stockAlerta' | translate }}</ion-label>
          <ion-input [(ngModel)]="crearStockAlerta" type="number" placeholder="Stock alerta"></ion-input>
        </ion-item>
        <ion-button expand="full" (click)="crearProducto()">{{ 'productos.botones.crear' | translate }}</ion-button>
      </ion-content>
    </ng-template> 
  </ion-modal>

  <ion-modal trigger="prod-editar-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ 'productos.botones.editarProductos' | translate }}</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.nombre' | translate }}</ion-label>
          <ion-input [(ngModel)]="editarNombre" placeholder="Izena"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.descripcion' | translate }}</ion-label>
          <ion-input [(ngModel)]="editarDescripcion" placeholder="Deskribapena"></ion-input>
        </ion-item>
        <ion-item>
          <ion-select [(ngModel)]="editarCategoria" label="Kategoria" placeholder="Selecciona una kategoria">
            <ion-select-option *ngFor="let cat of produktuak" [value]="cat.id">{{cat.izena}}</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.marca' | translate }}</ion-label>
          <ion-input [(ngModel)]="editarMarca" placeholder="Marka"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.stock' | translate }}</ion-label>
          <ion-input [(ngModel)]="editarStock" type="number" placeholder="Stock"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.stockAlerta' | translate }}</ion-label>
          <ion-input [(ngModel)]="editarStockAlerta" type="number" placeholder="Stock alerta"></ion-input>
        </ion-item>
        <ion-button expand="full" (click)="editarProducto()">{{ 'productos.botones.crear' | translate }}</ion-button>
      </ion-content>
    </ng-template> 
  </ion-modal>

  <ion-modal trigger="cat-sortu-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ 'productos.botones.crearCategoria' | translate }}</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-item>
          <ion-label position="stacked">{{ 'productos.modal.nombre' | translate }}</ion-label>
          <ion-input [(ngModel)]="crearKatNombre" placeholder="Izena"></ion-input>
        </ion-item>
        <ion-button expand="full" (click)="kategoriaSortu()">{{ 'productos.botones.crear' | translate }}</ion-button>
      </ion-content>
    </ng-template> 
  </ion-modal>
</ion-content>

